<!doctype html><html lang=en-us dir=ltr><head><meta charset=utf-8><meta name=viewport content='width=device-width,initial-scale=1'><meta name=description content="Version of ImageEditor using GLSL compute shaders"><title>CSImage</title>
<link rel=canonical href=https://cmanziel.github.io/p/csimage/><link rel=stylesheet href=/scss/style.min.663803bebe609202d5b39d848f2d7c2dc8b598a2d879efa079fa88893d29c49c.css><meta property='og:title' content="CSImage"><meta property='og:description' content="Version of ImageEditor using GLSL compute shaders"><meta property='og:url' content='https://cmanziel.github.io/p/csimage/'><meta property='og:site_name' content='Claudio Mandelli'><meta property='og:type' content='article'><meta property='article:section' content='Post'><meta property='article:tag' content='OpenGL'><meta property='og:image' content='https://cmanziel.github.io/p/csimage/effects.png'><meta name=twitter:title content="CSImage"><meta name=twitter:description content="Version of ImageEditor using GLSL compute shaders"><meta name=twitter:card content="summary_large_image"><meta name=twitter:image content='https://cmanziel.github.io/p/csimage/effects.png'><link rel="shortcut icon" href=/favicon.ico></head><body class=article-page><script>(function(){const e="StackColorScheme";localStorage.getItem(e)||localStorage.setItem(e,"auto")})()</script><script>(function(){const t="StackColorScheme",e=localStorage.getItem(t),n=window.matchMedia("(prefers-color-scheme: dark)").matches===!0;e=="dark"||e==="auto"&&n?document.documentElement.dataset.scheme="dark":document.documentElement.dataset.scheme="light"})()</script><div class="container main-container flex on-phone--column extended"><aside class="sidebar left-sidebar sticky"><button class="hamburger hamburger--spin" type=button id=toggle-menu aria-label="Toggle Menu">
<span class=hamburger-box><span class=hamburger-inner></span></span></button><header><figure class=site-avatar><a href=/><img src=/img/avatar_quad_hu9968688739216331654.jpeg width=300 height=300 class=site-logo loading=lazy alt=Avatar></a></figure><div class=site-meta><h1 class=site-name><a href=/>Claudio Mandelli</a></h1><h2 class=site-description></h2></div></header><ol class=menu-social><li><a href=mailto:claudio.mandelli01@gmail.com target=_blank title=E-mail rel=me><svg width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="#fff" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="icon icon-tabler icons-tabler-outline icon-tabler-mail"><path stroke="none" d="M0 0h24v24H0z" fill="none"/><path d="M3 7a2 2 0 012-2h14a2 2 0 012 2v10a2 2 0 01-2 2H5a2 2 0 01-2-2V7z"/><path d="M3 7l9 6 9-6"/></svg></a></li><li><a href=https://github.com/cmanziel target=_blank title=GitHub rel=me><svg class="icon icon-tabler icon-tabler-brand-github" width="24" height="24" viewBox="0 0 24 24" stroke-width="2" stroke="currentcolor" fill="none" stroke-linecap="round" stroke-linejoin="round"><path stroke="none" d="M0 0h24v24H0z" fill="none"/><path d="M9 19c-4.3 1.4-4.3-2.5-6-3m12 5v-3.5c0-1 .1-1.4-.5-2 2.8-.3 5.5-1.4 5.5-6a4.6 4.6.0 00-1.3-3.2 4.2 4.2.0 00-.1-3.2s-1.1-.3-3.5 1.3a12.3 12.3.0 00-6.2.0C6.5 2.8 5.4 3.1 5.4 3.1a4.2 4.2.0 00-.1 3.2A4.6 4.6.0 004 9.5c0 4.6 2.7 5.7 5.5 6-.6.6-.6 1.2-.5 2V21"/></svg></a></li></ol><ol class=menu id=main-menu><li><a href=/><svg class="icon icon-tabler icon-tabler-home" width="24" height="24" viewBox="0 0 24 24" stroke-width="2" stroke="currentcolor" fill="none" stroke-linecap="round" stroke-linejoin="round"><path stroke="none" d="M0 0h24v24H0z"/><polyline points="5 12 3 12 12 3 21 12 19 12"/><path d="M5 12v7a2 2 0 002 2h10a2 2 0 002-2v-7"/><path d="M9 21v-6a2 2 0 012-2h2a2 2 0 012 2v6"/></svg>
<span>Home</span></a></li><li><a href=/about/><svg width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="#fff" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="icon icon-tabler icons-tabler-outline icon-tabler-user"><path stroke="none" d="M0 0h24v24H0z" fill="none"/><path d="M8 7a4 4 0 108 0A4 4 0 008 7"/><path d="M6 21v-2a4 4 0 014-4h4a4 4 0 014 4v2"/></svg>
<span>About Me</span></a></li><li><a href=/search/><svg class="icon icon-tabler icon-tabler-search" width="24" height="24" viewBox="0 0 24 24" stroke-width="2" stroke="currentcolor" fill="none" stroke-linecap="round" stroke-linejoin="round"><path stroke="none" d="M0 0h24v24H0z"/><circle cx="10" cy="10" r="7"/><line x1="21" y1="21" x2="15" y2="15"/></svg>
<span>Search</span></a></li><li class=menu-bottom-section><ol class=menu><li id=dark-mode-toggle><svg class="icon icon-tabler icon-tabler-toggle-left" width="24" height="24" viewBox="0 0 24 24" stroke-width="2" stroke="currentcolor" fill="none" stroke-linecap="round" stroke-linejoin="round"><path stroke="none" d="M0 0h24v24H0z"/><circle cx="8" cy="12" r="2"/><rect x="2" y="6" width="20" height="12" rx="6"/></svg>
<svg class="icon icon-tabler icon-tabler-toggle-right" width="24" height="24" viewBox="0 0 24 24" stroke-width="2" stroke="currentcolor" fill="none" stroke-linecap="round" stroke-linejoin="round"><path stroke="none" d="M0 0h24v24H0z"/><circle cx="16" cy="12" r="2"/><rect x="2" y="6" width="20" height="12" rx="6"/></svg>
<span>Dark Mode</span></li></ol></li></ol></aside><aside class="sidebar right-sidebar sticky"><section class="widget archives"><div class=widget-icon><svg class="icon icon-tabler icon-tabler-hash" width="24" height="24" viewBox="0 0 24 24" stroke-width="2" stroke="currentcolor" fill="none" stroke-linecap="round" stroke-linejoin="round"><path stroke="none" d="M0 0h24v24H0z"/><line x1="5" y1="9" x2="19" y2="9"/><line x1="5" y1="15" x2="19" y2="15"/><line x1="11" y1="4" x2="7" y2="20"/><line x1="17" y1="4" x2="13" y2="20"/></svg></div><h2 class="widget-title section-title">Table of contents</h2><div class=widget--toc><nav id=TableOfContents><ol><li><a href=#drawing>Drawing</a></li><li><a href=#brush-effects>Brush Effects</a><ol><li><a href=#edge-detection-sobel-operator>Edge Detection (Sobel Operator)</a></li><li><a href=#blur-box-blur>Blur (Box Blur)</a></li></ol></li></ol></nav></div></section></aside><main class="main full-width"><article class="has-image main-article"><header class=article-header><div class=article-image><a href=/p/csimage/><img src=/p/csimage/effects_hu14557320256237983649.png srcset="/p/csimage/effects_hu14557320256237983649.png 800w, /p/csimage/effects_hu7177828273650411905.png 1600w" width=800 height=594 loading=lazy alt="Featured image of post CSImage"></a></div><div class=article-details><header class=article-category><a href=/categories/image-processing/>Image Processing</a></header><div class=article-title-wrapper><h2 class=article-title><a href=/p/csimage/>CSImage</a></h2><h3 class=article-subtitle>Version of ImageEditor using GLSL compute shaders</h3></div></div></header><section class=article-content><p>This project is a refactor of the <a class=link href=https://github.com/cmanziel/ImageEditor target=_blank rel=noopener>ImageEditor</a> project. The first version of the project was mainly relying on the CPU for all the drawing and effects processes. This one uses compute shaders for every step of the way. <a class=link href=https://github.com/cmanziel/CSImage target=_blank rel=noopener>Source code</a>.</p><h2 id=drawing>Drawing</h2><p>Each drawing style the brush can have has its own shader. The shader samples the canvas texture to retrieve the background color through GLSL&rsquo;s <em>imageLoad</em> function, and stores the color being drawn into the render target texture.
After the off-screen rendering is done, the render texture is mapped to the vertices of a quad which is rendered through the usual vertex and fragment shader.</p><p>For every compute shader, a <em>brush radius</em> * <em>brush radius</em> number of work groups is dispatched. The <em>local_size</em> of every work group is 1 x 1 x 1, so the image can be accessed using the <em>gl_GlobalInvocationID.xy</em> built-in variable as the UV coordinates.</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt>1
</span><span class=lnt>2
</span><span class=lnt>3
</span><span class=lnt>4
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-C++ data-lang=C++><span class=line><span class=cl><span class=kt>void</span> <span class=nf>Execute</span><span class=p>()</span>
</span></span><span class=line><span class=cl><span class=p>{</span>
</span></span><span class=line><span class=cl>    <span class=n>Dispatch</span><span class=p>(</span><span class=n>m_BrushRadius</span><span class=p>,</span> <span class=n>m_BrushRadius</span><span class=p>,</span> <span class=mi>1</span><span class=p>);</span>
</span></span><span class=line><span class=cl><span class=p>}</span>
</span></span></code></pre></td></tr></table></div></div><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt>1
</span><span class=lnt>2
</span><span class=lnt>3
</span><span class=lnt>4
</span><span class=lnt>5
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-C++ data-lang=C++><span class=line><span class=cl><span class=kt>void</span> <span class=nf>Dispatch</span><span class=p>(</span><span class=kt>unsigned</span> <span class=kt>int</span> <span class=n>xGroups</span><span class=p>,</span> <span class=kt>unsigned</span> <span class=kt>int</span> <span class=n>yGroups</span><span class=p>,</span> <span class=kt>unsigned</span> <span class=kt>int</span> <span class=n>zGroups</span><span class=p>)</span>
</span></span><span class=line><span class=cl><span class=p>{</span>
</span></span><span class=line><span class=cl>    <span class=n>glDispatchCompute</span><span class=p>(</span><span class=n>xGroups</span><span class=p>,</span> <span class=n>yGroups</span><span class=p>,</span> <span class=n>zGroups</span><span class=p>);</span>
</span></span><span class=line><span class=cl>    <span class=n>glMemoryBarrier</span><span class=p>(</span><span class=n>GL_SHADER_IMAGE_ACCESS_BARRIER_BIT</span> <span class=o>|</span> <span class=n>GL_SHADER_STORAGE_BARRIER_BIT</span><span class=p>);</span>
</span></span><span class=line><span class=cl><span class=p>}</span>
</span></span></code></pre></td></tr></table></div></div><h2 id=brush-effects>Brush Effects</h2><h3 id=edge-detection-sobel-operator>Edge Detection (Sobel Operator)</h3><p><a class=link href=https://en.wikipedia.org/wiki/Sobel_operator target=_blank rel=noopener>Two kernels</a> are defined to process every pixel in area covered by the brush based on its surrounding pixels.
The effect is applied on everything that has been drawn onto the canvas and not only on the original canvas.</p><p>To prevent <em>imageStore</em> operations to affect <em>imageLoad</em> operations in the same shader dispatch a separate canvas texture image is used.
This prevents an <em>imageLoad</em> operation to get the value of another pixel in the grid which was just modified by the same operation that is being done on the current one.</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt> 1
</span><span class=lnt> 2
</span><span class=lnt> 3
</span><span class=lnt> 4
</span><span class=lnt> 5
</span><span class=lnt> 6
</span><span class=lnt> 7
</span><span class=lnt> 8
</span><span class=lnt> 9
</span><span class=lnt>10
</span><span class=lnt>11
</span><span class=lnt>12
</span><span class=lnt>13
</span><span class=lnt>14
</span><span class=lnt>15
</span><span class=lnt>16
</span><span class=lnt>17
</span><span class=lnt>18
</span><span class=lnt>19
</span><span class=lnt>20
</span><span class=lnt>21
</span><span class=lnt>22
</span><span class=lnt>23
</span><span class=lnt>24
</span><span class=lnt>25
</span><span class=lnt>26
</span><span class=lnt>27
</span><span class=lnt>28
</span><span class=lnt>29
</span><span class=lnt>30
</span><span class=lnt>31
</span><span class=lnt>32
</span><span class=lnt>33
</span><span class=lnt>34
</span><span class=lnt>35
</span><span class=lnt>36
</span><span class=lnt>37
</span><span class=lnt>38
</span><span class=lnt>39
</span><span class=lnt>40
</span><span class=lnt>41
</span><span class=lnt>42
</span><span class=lnt>43
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-C data-lang=C><span class=line><span class=cl><span class=kt>float</span> <span class=nf>kernel_mult</span><span class=p>(</span><span class=n>ivec2</span> <span class=n>pixel_uv</span><span class=p>,</span> <span class=kt>int</span> <span class=n>ch</span><span class=p>,</span> <span class=n>mat3</span> <span class=n>kernel</span><span class=p>)</span>
</span></span><span class=line><span class=cl><span class=p>{</span>
</span></span><span class=line><span class=cl>    <span class=kt>float</span> <span class=n>kernel_sum</span> <span class=o>=</span> <span class=mi>0</span><span class=p>;</span>
</span></span><span class=line><span class=cl>    <span class=n>ivec2</span> <span class=n>dims</span> <span class=o>=</span> <span class=nf>imageSize</span><span class=p>(</span><span class=n>edited</span><span class=p>);</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>    <span class=k>for</span><span class=p>(</span><span class=kt>int</span> <span class=n>y</span> <span class=o>=</span> <span class=o>-</span><span class=mi>1</span><span class=p>;</span> <span class=n>y</span> <span class=o>&lt;</span> <span class=mi>2</span><span class=p>;</span> <span class=n>y</span><span class=o>++</span><span class=p>)</span>
</span></span><span class=line><span class=cl>    <span class=p>{</span>
</span></span><span class=line><span class=cl>        <span class=k>for</span><span class=p>(</span><span class=kt>int</span> <span class=n>x</span> <span class=o>=</span> <span class=o>-</span><span class=mi>1</span><span class=p>;</span> <span class=n>x</span> <span class=o>&lt;</span> <span class=mi>2</span><span class=p>;</span> <span class=n>x</span><span class=o>++</span><span class=p>)</span>
</span></span><span class=line><span class=cl>        <span class=p>{</span>
</span></span><span class=line><span class=cl>            <span class=n>ivec2</span> <span class=n>grid_uv</span> <span class=o>=</span> <span class=n>pixel_uv</span> <span class=o>+</span> <span class=nf>ivec2</span><span class=p>(</span><span class=n>x</span><span class=p>,</span> <span class=n>y</span><span class=p>);</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>            <span class=n>vec4</span> <span class=n>current_color</span> <span class=o>=</span> <span class=nf>imageLoad</span><span class=p>(</span><span class=n>sobelCanvas</span><span class=p>,</span> <span class=nf>ivec2</span><span class=p>(</span><span class=n>grid_uv</span><span class=p>.</span><span class=n>x</span><span class=p>,</span> <span class=n>grid_uv</span><span class=p>.</span><span class=n>y</span><span class=p>));</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>            <span class=n>kernel_sum</span> <span class=o>+=</span> <span class=kt>int</span><span class=p>(</span><span class=n>current_color</span><span class=p>[</span><span class=n>ch</span><span class=p>]</span> <span class=o>*</span> <span class=n>kernel</span><span class=p>[</span><span class=n>x</span> <span class=o>+</span> <span class=mi>1</span><span class=p>][</span><span class=mi>1</span> <span class=o>-</span> <span class=n>y</span><span class=p>]);</span>
</span></span><span class=line><span class=cl>        <span class=p>}</span>
</span></span><span class=line><span class=cl>    <span class=p>}</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>    <span class=k>return</span> <span class=n>kernel_sum</span><span class=p>;</span>
</span></span><span class=line><span class=cl><span class=p>}</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=n>vec4</span> <span class=nf>edge_pixel</span><span class=p>(</span><span class=n>ivec2</span> <span class=n>uv</span><span class=p>)</span>
</span></span><span class=line><span class=cl><span class=p>{</span>
</span></span><span class=line><span class=cl>    <span class=c1>// imageLoad with an out of boundary coordinate returns an all zeroes vec4
</span></span></span><span class=line><span class=cl><span class=c1></span>    <span class=c1>// so for the edge pixels of the imagedo the kernel multiplication with out of bounds values as for the other pixels
</span></span></span><span class=line><span class=cl><span class=c1></span>
</span></span><span class=line><span class=cl>    <span class=n>vec4</span> <span class=n>result</span><span class=p>;</span>
</span></span><span class=line><span class=cl>    <span class=kt>float</span> <span class=n>sum</span> <span class=o>=</span> <span class=mi>0</span><span class=p>;</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>    <span class=c1>// for each of the rgb channels compute the kernel calculation
</span></span></span><span class=line><span class=cl><span class=c1></span>    <span class=k>for</span><span class=p>(</span><span class=kt>int</span> <span class=n>i</span> <span class=o>=</span> <span class=mi>0</span><span class=p>;</span> <span class=n>i</span> <span class=o>&lt;</span> <span class=mi>3</span><span class=p>;</span> <span class=n>i</span><span class=o>++</span><span class=p>)</span>
</span></span><span class=line><span class=cl>    <span class=p>{</span>
</span></span><span class=line><span class=cl>        <span class=kt>float</span> <span class=n>Gx</span> <span class=o>=</span> <span class=nf>kernel_mult</span><span class=p>(</span><span class=n>uv</span><span class=p>,</span> <span class=n>i</span><span class=p>,</span> <span class=n>sobel_kernel_Gx</span><span class=p>);</span>
</span></span><span class=line><span class=cl>        <span class=kt>float</span> <span class=n>Gy</span> <span class=o>=</span> <span class=nf>kernel_mult</span><span class=p>(</span><span class=n>uv</span><span class=p>,</span> <span class=n>i</span><span class=p>,</span> <span class=n>sobel_kernel_Gy</span><span class=p>);</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>        <span class=c1>// sqrt is a floating point operation
</span></span></span><span class=line><span class=cl><span class=c1></span>        <span class=n>result</span><span class=p>[</span><span class=n>i</span><span class=p>]</span> <span class=o>=</span> <span class=nf>sqrt</span><span class=p>(</span><span class=n>Gx</span> <span class=o>*</span> <span class=n>Gx</span> <span class=o>+</span> <span class=n>Gy</span> <span class=o>*</span> <span class=n>Gy</span> <span class=o>/</span> <span class=n>SOBEL_CLAMP_FLOAT_VALUE</span><span class=p>);</span>
</span></span><span class=line><span class=cl>        <span class=n>sum</span> <span class=o>+=</span> <span class=n>result</span><span class=p>[</span><span class=n>i</span><span class=p>];</span>
</span></span><span class=line><span class=cl>    <span class=p>}</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>    <span class=n>result</span><span class=p>.</span><span class=n>xyz</span> <span class=o>=</span> <span class=nf>vec3</span><span class=p>(</span><span class=n>sum</span> <span class=o>/</span> <span class=mi>3</span><span class=p>);</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>    <span class=k>return</span> <span class=n>result</span><span class=p>;</span>
</span></span><span class=line><span class=cl><span class=p>}</span>
</span></span></code></pre></td></tr></table></div></div><h3 id=blur-box-blur>Blur (Box Blur)</h3><p>A <a class=link href=https://en.wikipedia.org/wiki/Box_blur target=_blank rel=noopener>Box Blur</a> algorithm is applied to every pixel inside the brush area. The result is the average value between a 3x3 grid around each pixel. The effect is applied on everything that has been drawn onto the canvas and not only on the original canvas.</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt> 1
</span><span class=lnt> 2
</span><span class=lnt> 3
</span><span class=lnt> 4
</span><span class=lnt> 5
</span><span class=lnt> 6
</span><span class=lnt> 7
</span><span class=lnt> 8
</span><span class=lnt> 9
</span><span class=lnt>10
</span><span class=lnt>11
</span><span class=lnt>12
</span><span class=lnt>13
</span><span class=lnt>14
</span><span class=lnt>15
</span><span class=lnt>16
</span><span class=lnt>17
</span><span class=lnt>18
</span><span class=lnt>19
</span><span class=lnt>20
</span><span class=lnt>21
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-C data-lang=C><span class=line><span class=cl><span class=n>vec4</span> <span class=nf>blur_pixel</span><span class=p>(</span><span class=n>ivec2</span> <span class=n>uv</span><span class=p>,</span> <span class=n>ivec2</span> <span class=n>dims</span><span class=p>)</span>
</span></span><span class=line><span class=cl><span class=p>{</span>
</span></span><span class=line><span class=cl>    <span class=n>vec4</span> <span class=n>result</span><span class=p>;</span>
</span></span><span class=line><span class=cl>    <span class=c1>// if the pixel is on the edge of the image, return it unmodified
</span></span></span><span class=line><span class=cl><span class=c1></span>    <span class=k>if</span><span class=p>(</span><span class=n>uv</span><span class=p>.</span><span class=n>x</span> <span class=o>&lt;</span> <span class=mi>1</span> <span class=o>||</span> <span class=n>uv</span><span class=p>.</span><span class=n>y</span> <span class=o>&lt;</span> <span class=mi>1</span> <span class=o>||</span> <span class=n>uv</span><span class=p>.</span><span class=n>x</span> <span class=o>+</span> <span class=mi>1</span> <span class=o>==</span> <span class=n>dims</span><span class=p>.</span><span class=n>x</span> <span class=o>||</span> <span class=n>uv</span><span class=p>.</span><span class=n>y</span> <span class=o>+</span> <span class=mi>1</span> <span class=o>==</span> <span class=n>dims</span><span class=p>.</span><span class=n>y</span><span class=p>)</span>
</span></span><span class=line><span class=cl>        <span class=k>return</span> <span class=nf>imageLoad</span><span class=p>(</span><span class=n>blurCanvas</span><span class=p>,</span> <span class=n>uv</span><span class=p>);</span>
</span></span><span class=line><span class=cl>    <span class=k>for</span><span class=p>(</span><span class=kt>int</span> <span class=n>y</span> <span class=o>=</span> <span class=o>-</span><span class=mi>1</span><span class=p>;</span> <span class=n>y</span> <span class=o>&lt;</span> <span class=mi>2</span><span class=p>;</span> <span class=n>y</span><span class=o>++</span><span class=p>)</span>
</span></span><span class=line><span class=cl>    <span class=p>{</span>
</span></span><span class=line><span class=cl>        <span class=k>for</span><span class=p>(</span><span class=kt>int</span> <span class=n>x</span> <span class=o>=</span> <span class=o>-</span><span class=mi>1</span><span class=p>;</span> <span class=n>x</span> <span class=o>&lt;</span> <span class=mi>2</span><span class=p>;</span> <span class=n>x</span><span class=o>++</span><span class=p>)</span>
</span></span><span class=line><span class=cl>        <span class=p>{</span>
</span></span><span class=line><span class=cl>            <span class=k>if</span><span class=p>(</span><span class=n>x</span> <span class=o>==</span> <span class=mi>0</span> <span class=o>&amp;&amp;</span> <span class=n>y</span> <span class=o>==</span> <span class=mi>0</span><span class=p>)</span>
</span></span><span class=line><span class=cl>                <span class=k>continue</span><span class=p>;</span>
</span></span><span class=line><span class=cl>            <span class=n>ivec2</span> <span class=n>grid_uv</span> <span class=o>=</span> <span class=n>uv</span> <span class=o>+</span> <span class=nf>ivec2</span><span class=p>(</span><span class=n>x</span><span class=p>,</span> <span class=n>y</span><span class=p>);</span>
</span></span><span class=line><span class=cl>            <span class=n>vec4</span> <span class=n>current_color</span> <span class=o>=</span> <span class=nf>imageLoad</span><span class=p>(</span><span class=n>blurCanvas</span><span class=p>,</span> <span class=nf>ivec2</span><span class=p>(</span><span class=n>grid_uv</span><span class=p>.</span><span class=n>x</span><span class=p>,</span> <span class=n>grid_uv</span><span class=p>.</span><span class=n>y</span><span class=p>));</span>
</span></span><span class=line><span class=cl>            <span class=n>result</span> <span class=o>+=</span> <span class=n>current_color</span><span class=p>;</span>
</span></span><span class=line><span class=cl>        <span class=p>}</span>
</span></span><span class=line><span class=cl>    <span class=p>}</span>
</span></span><span class=line><span class=cl>    
</span></span><span class=line><span class=cl>    <span class=n>result</span><span class=p>.</span><span class=n>xyz</span> <span class=o>/=</span> <span class=mi>9</span><span class=p>;</span>
</span></span><span class=line><span class=cl>    <span class=k>return</span> <span class=n>result</span><span class=p>;</span>
</span></span><span class=line><span class=cl><span class=p>}</span>
</span></span></code></pre></td></tr></table></div></div></section><footer class=article-footer><section class=article-tags><a href=/tags/opengl/>OpenGL</a></section></footer></article><aside class=related-content--wrapper><h2 class=section-title>Related content</h2><div class=related-content><div class="flex article-list--tile"><article class=has-image><a href=/p/imageeditor/><div class=article-image><img src=/p/imageeditor/collage.5af8a41ca9a45d3c9b066b830305ffd8_hu3863994283577959878.png width=250 height=150 loading=lazy alt="Featured image of post ImageEditor" data-hash="md5-WvikHKmkXTybBmuDAwX/2A=="></div><div class=article-details><h2 class=article-title>ImageEditor</h2></div></a></article><article class=has-image><a href=/p/pnglib/><div class=article-image><img src=/p/pnglib/cover.6514b4a3fc21eecb865b5e3b531c90cf_hu10023658628366470928.jpg width=250 height=150 loading=lazy alt="Featured image of post pnglib" data-hash="md5-ZRS0o/wh7suGW147UxyQzw=="></div><div class=article-details><h2 class=article-title>pnglib</h2></div></a></article></div></div></aside><footer class=site-footer><section class=copyright>&copy;
2020 -
2024 Claudio Mandelli</section><section class=powerby>Built with <a href=https://gohugo.io/ target=_blank rel=noopener>Hugo</a><br>Theme <b><a href=https://github.com/CaiJimmy/hugo-theme-stack target=_blank rel=noopener data-version=3.27.0>Stack</a></b> designed by <a href=https://jimmycai.com target=_blank rel=noopener>Jimmy</a></section></footer><div class=pswp tabindex=-1 role=dialog aria-hidden=true><div class=pswp__bg></div><div class=pswp__scroll-wrap><div class=pswp__container><div class=pswp__item></div><div class=pswp__item></div><div class=pswp__item></div></div><div class="pswp__ui pswp__ui--hidden"><div class=pswp__top-bar><div class=pswp__counter></div><button class="pswp__button pswp__button--close" title="Close (Esc)"></button>
<button class="pswp__button pswp__button--share" title=Share></button>
<button class="pswp__button pswp__button--fs" title="Toggle fullscreen"></button>
<button class="pswp__button pswp__button--zoom" title="Zoom in/out"></button><div class=pswp__preloader><div class=pswp__preloader__icn><div class=pswp__preloader__cut><div class=pswp__preloader__donut></div></div></div></div></div><div class="pswp__share-modal pswp__share-modal--hidden pswp__single-tap"><div class=pswp__share-tooltip></div></div><button class="pswp__button pswp__button--arrow--left" title="Previous (arrow left)">
</button>
<button class="pswp__button pswp__button--arrow--right" title="Next (arrow right)"></button><div class=pswp__caption><div class=pswp__caption__center></div></div></div></div></div><script src=https://cdn.jsdelivr.net/npm/photoswipe@4.1.3/dist/photoswipe.min.js integrity="sha256-ePwmChbbvXbsO02lbM3HoHbSHTHFAeChekF1xKJdleo=" crossorigin=anonymous defer></script><script src=https://cdn.jsdelivr.net/npm/photoswipe@4.1.3/dist/photoswipe-ui-default.min.js integrity="sha256-UKkzOn/w1mBxRmLLGrSeyB4e1xbrp4xylgAWb3M42pU=" crossorigin=anonymous defer></script><link rel=stylesheet href=https://cdn.jsdelivr.net/npm/photoswipe@4.1.3/dist/default-skin/default-skin.min.css crossorigin=anonymous><link rel=stylesheet href=https://cdn.jsdelivr.net/npm/photoswipe@4.1.3/dist/photoswipe.min.css crossorigin=anonymous></main></div><script src=https://cdn.jsdelivr.net/npm/node-vibrant@3.1.6/dist/vibrant.min.js integrity="sha256-awcR2jno4kI5X0zL8ex0vi2z+KMkF24hUW8WePSA9HM=" crossorigin=anonymous></script><script type=text/javascript src=/ts/main.js defer></script><script>(function(){const e=document.createElement("link");e.href="https://fonts.googleapis.com/css2?family=Lato:wght@300;400;700&display=swap",e.type="text/css",e.rel="stylesheet",document.head.appendChild(e)})()</script></body></html>